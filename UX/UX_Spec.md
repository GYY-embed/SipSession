# SipSession UX Spec（MVP）

> 基于 PRD 的交互与行为规范，聚焦页面行为规则、交互约束与异常情况处理。

## 1. 全局原则
- 记录优先：核心路径保证“低成本计杯 + 可回溯数据”。
- 双端一致：状态以最新事件时间为准，iPhone 可接管当前 Session。
- 仅影响后续：模板配置与默认参数调整只作用于后续记录。
- 可追溯：所有结束都记录 ended_reason。

## 2. 全局交互与约束
- Session 状态：`active` ↔ `paused` → `ended`（终态不可回退）。
- 结束行为：必须二次确认；自动结束需有提示与可取消窗口。
- Watch 端不提供任何编辑类操作（杯量/ABV/名称/模板编辑）。
- iPhone 端禁止“直接计杯”（MVP 仅 Watch 端记录饮酒）。
- “喝点什么”作为统一入口文案，覆盖开局与局中配置。
- 头像/名称为必填项：未设置时提示补充；报告展示需优雅降级（如“未命名”）。

## 3. 数据同步与异常
- iPhone/Watch 未连接：
  - Watch 端继续本地记录，恢复连接后批量同步。
  - iPhone 展示“未连接/数据延迟”状态，不阻断控制。
- 心率不可用：显示“不可用/未连接”，不影响计杯与控制。
- 相册权限拒绝：分享图保存失败提示，并提供系统设置入口。

## 4. iPhone 页面行为

### iPhone / 开局 / 酒局开始
- 行为规则：
  - 必须先选择“本次可用饮品”才能开始；默认选中系统预置的 1–2 种（由产品定义）。
  - 临时调整杯量仅作用于本次酒局，不影响模板默认值。
- 约束：不允许新增自定义模板。
- 异常：
  - Watch 未连接：允许开局，提示“稍后同步到 Watch”。

### iPhone / 酒局进行中 / 状态与控制
- 行为规则：
  - 页面常驻显示当前统计与心率状态。
  - “暂停/继续”立即同步到 Watch；失败时提示并保持本地状态不变。
- 约束：不允许 iPhone 端计杯。
- 异常：
  - 心率缺失：展示占位文案，不影响其他数据。

### iPhone / 酒局进行中 / 喝点什么
- 行为规则：
  - 可切换默认饮品，且立刻同步到 Watch。
  - 允许从预置列表新增一种饮品进入本次列表。
  - 可调整默认容量/ABV，仅影响之后记录。
- 约束：
  - 不允许删除正在使用的模板。
  - 不允许自定义新增模板（MVP）。
- 异常：
  - Watch 未连接时可本地修改，恢复连接后同步。

### iPhone / 酒局进行中 / 单杯微调
- 行为规则：
  - 支持对已记录单杯调整杯量/ABV/名称（可选）。
  - 保存后触发总量、报告与分享图数据重算。
- 约束：
  - 仅限“进行中”阶段；结束后入口隐藏。
- 异常：
  - 若重算失败，保留原数据并提示重试。

### iPhone / 报告 / 酒局报告详情
- 行为规则：
  - 结束后自动展示；历史进入保持只读。
  - 报告展示头像与名称。
  - 分享图生成后保存到相册。
- 约束：
  - 禁止报告内修改饮酒记录（MVP）。
- 异常：
  - 生成图片失败：提示重试与问题原因（权限/数据缺失）。

### iPhone / 历史 / 酒局列表
- 行为规则：
  - 按时间倒序展示摘要信息。
- 约束：
  - 不提供批量编辑/删除（MVP）。

### iPhone / 个人 / Profile
- 行为规则：
  - 头像与名称入口必须可见。
  - 模板配置入口仅显示预置模板信息。

### iPhone / 个人 / 头像与名称
- 行为规则：
  - 支持上传头像与设置名称。
  - 变更后即刻应用于报告与分享图。
- 异常：
  - 图片读取失败或权限受限：提示并允许跳过。

### iPhone / 个人 / 模板配置
- 行为规则：
  - 展示 5 种预置模板与默认参数。
  - 可设置默认饮品（影响开局默认选择）。
- 约束：
  - 不允许新增/删除模板（MVP）。

### iPhone / 个人 / 程序设置
- 行为规则：
  - 仅提供入口（TBD）。

## 5. Watch 页面行为

### Watch / 开局 / 默认入口
- 行为规则：
  - 无进行中 Session 时显示“开始”按钮。
  - 若 iPhone 未同步配置，使用 Fallback 模板列表。
- 异常：
  - 无法启动心率采集时提示，但允许继续开局。

### Watch / 酒局 / 记录页（中间页）
- 行为规则：
  - 单击 `+1` 立即记录并写入心率窗口统计。
  - 切换默认饮品仅影响后续记录。
- 约束：
  - 不允许任何编辑与微调。

### Watch / 酒局 / 控制页（左页）
- 行为规则：
  - 暂停/继续切换需状态确认。
  - 结束必须二次确认。

### Watch / 酒局 / 汇总页（右页）
- 行为规则：
  - 只读状态，展示当前累计。

### Watch / 酒局 / 结束简要汇总
- 行为规则：
  - 结束后自动展示 10–30 秒或用户主动退出。
  - 提示在 iPhone 查看完整报告。

## 6. 自动结束机制（兜底）
- 目的：覆盖“喝过量忘记关闭”或“中途离开未结束”，确保数据有效性。
- 规则：
  - 连续 15 分钟无记录弹窗提示；无响应 15/30/45 分钟自动结束。
  - 离腕 5–10 分钟未恢复自动结束。
- 交互：
  - 弹窗提供“继续/结束”选择；无响应按规则终止。
- 记录：
  - `ended_reason` 必填：`manual_watch` / `manual_phone` / `auto_timeout` / `off_wrist`。

